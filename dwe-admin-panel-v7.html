<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ± - Dar Wa Emaar Game Center</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cairo', sans-serif;
        }

        :root {
            --primary-color: #f36f2a;
            --primary-dark: #d85a1a;
            --bg-color: #f5f5f5;
            --text-dark: #333;
            --white: #ffffff;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
            --success: #4caf50;
            --error: #f44336;
            --warning: #ff9800;
        }

        body {
            background: linear-gradient(135deg, var(--bg-color) 0%, #e0e0e0 100%);
            min-height: 100vh;
            direction: rtl;
        }

        .header {
            background: var(--white);
            padding: 1rem;
            box-shadow: var(--shadow);
            position: relative;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            max-height: 60px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Auth Container */
        .auth-container {
            max-width: 400px;
            margin: 3rem auto;
            background: var(--white);
            padding: 2rem;
            border-radius: 10px;
            box-shadow: var(--shadow);
        }

        /* Dashboard */
        .dashboard {
            display: none;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }

        /* Sidebar */
        .sidebar {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: var(--shadow);
            height: fit-content;
        }

        .sidebar-item {
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .sidebar-item:hover {
            background: rgba(243, 111, 42, 0.1);
        }

        .sidebar-item.active {
            background: var(--primary-color);
            color: var(--white);
        }

        .sidebar-icon {
            font-size: 1.5rem;
        }

        /* Content Area */
        .content-area {
            background: var(--white);
            padding: 2rem;
            border-radius: 10px;
            box-shadow: var(--shadow);
        }

        .content-header {
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e0e0e0;
        }

        .content-header h2 {
            color: var(--text-dark);
            font-size: 2rem;
        }

        /* Forms */
        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-dark);
            font-weight: 600;
        }

        input, select, textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .btn {
            padding: 0.75rem 2rem;
            background: var(--primary-color);
            color: var(--white);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #757575;
        }

        .btn-success {
            background: var(--success);
        }

        .btn-danger {
            background: var(--error);
        }

        .btn-warning {
            background: var(--warning);
        }

        /* File Upload */
        .file-upload {
            border: 2px dashed var(--primary-color);
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }

        .file-upload:hover {
            background: rgba(243, 111, 42, 0.05);
        }

        .file-upload.dragging {
            background: rgba(243, 111, 42, 0.1);
            border-color: var(--primary-dark);
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 1rem;
            text-align: right;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background: var(--bg-color);
            font-weight: 700;
            color: var(--text-dark);
        }

        tr:hover {
            background: #f5f5f5;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: var(--shadow);
            border-right: 4px solid var(--primary-color);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .stat-label {
            color: #757575;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        /* Game Status Cards */
        .game-status-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: var(--shadow);
            margin-bottom: 1rem;
            border-right: 4px solid var(--primary-color);
        }

        .game-status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .game-status-header h3 {
            color: var(--text-dark);
            font-size: 1.3rem;
            margin: 0;
        }

        .game-icon-large {
            font-size: 2rem;
            margin-left: 1rem;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            right: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--success);
        }

        input:checked + .slider:before {
            transform: translateX(-26px);
        }

        .game-hint-input {
            margin-top: 1rem;
            display: none;
        }

        .last-modified {
            font-size: 0.85rem;
            color: #757575;
            margin-top: 0.5rem;
        }

        /* Game Word Forms */
        .game-word-form {
            background: var(--bg-color);
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
        }

        .word-item {
            background: var(--white);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border: 1px solid #e0e0e0;
        }

        .word-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        /* Challenge Form */
        .challenge-form {
            background: var(--bg-color);
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
        }

        .challenge-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: var(--shadow);
            margin-bottom: 1rem;
            border-right: 4px solid var(--primary-color);
        }

        .challenge-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .challenge-info-item {
            padding: 0.5rem;
            background: var(--bg-color);
            border-radius: 5px;
        }

        .challenge-info-label {
            font-size: 0.85rem;
            color: #757575;
            margin-bottom: 0.25rem;
        }

        .challenge-info-value {
            font-weight: 600;
            color: var(--text-dark);
        }

        .days-remaining {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: var(--warning);
            color: white;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--white);
            padding: 2rem;
            border-radius: 10px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--text-dark);
        }

        .close-modal {
            position: absolute;
            top: 1rem;
            left: 1rem;
            font-size: 2rem;
            cursor: pointer;
            color: #757575;
        }

        /* Loading */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .message {
            padding: 1rem;
            border-radius: 5px;
            margin: 1rem 0;
            font-weight: 600;
        }

        .message.success {
            background: rgba(76, 175, 80, 0.1);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .message.error {
            background: rgba(244, 67, 54, 0.1);
            color: var(--error);
            border: 1px solid var(--error);
        }

        .message.warning {
            background: rgba(255, 152, 0, 0.1);
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        /* Charts */
        .chart-container {
            position: relative;
            height: 300px;
            margin: 2rem 0;
        }

        /* Logo Preview */
        .logo-preview {
            max-width: 200px;
            max-height: 150px;
            margin: 1rem 0;
            border: 1px solid #e0e0e0;
            padding: 1rem;
            border-radius: 5px;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .btn-icon {
            padding: 0.5rem;
            font-size: 1.2rem;
            min-width: auto;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 1rem 1.5rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab:hover {
            background: rgba(243, 111, 42, 0.05);
        }

        .tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                display: flex;
                overflow-x: auto;
                gap: 1rem;
                padding: 1rem;
            }
            
            .sidebar-item {
                min-width: 120px;
                justify-content: center;
                text-align: center;
                margin: 0;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>

    <div class="header">
        <div class="header-content">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <img id="headerLogo" class="logo" src="" alt="Dar Wa Emaar" style="display:none;">
                <h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±</h1>
            </div>
            <button class="btn btn-secondary" id="logoutBtn" style="display:none;" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        </div>
    </div>

    <div class="container">
        <!-- Login Form -->
        <div class="auth-container" id="authContainer">
            <h2>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±</h2>
            <div id="messageBox"></div>
            <form id="authForm">
                <div class="form-group">
                    <label for="email">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                    <input type="email" id="email" required>
                </div>
                <div class="form-group">
                    <label for="password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" class="btn" style="width:100%;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
            </form>
        </div>

        <!-- Dashboard -->
        <div class="dashboard" id="dashboard">
            <div class="dashboard-grid">
                <!-- Sidebar -->
                <div class="sidebar">
                    <div class="sidebar-item active" onclick="showSection('overview')">
                        <span class="sidebar-icon">ğŸ“Š</span>
                        <span>Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</span>
                    </div>
                    <div class="sidebar-item" onclick="showSection('gamesManagement')">
                        <span class="sidebar-icon">ğŸ®</span>
                        <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</span>
                    </div>
                    <div class="sidebar-item" onclick="showSection('employees')">
                        <span class="sidebar-icon">ğŸ‘¥</span>
                        <span>Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</span>
                    </div>
                    <div class="sidebar-item" onclick="showSection('challenges')">
                        <span class="sidebar-icon">ğŸ†</span>
                        <span>Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª</span>
                    </div>
                    <div class="sidebar-item" onclick="showSection('leaderboard')">
                        <span class="sidebar-icon">ğŸ¥‡</span>
                        <span>Ù„ÙˆØ­Ø© Ø§Ù„ØµØ¯Ø§Ø±Ø©</span>
                    </div>
                    <div class="sidebar-item" onclick="showSection('games')">
                        <span class="sidebar-icon">ğŸ“ˆ</span>
                        <span>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</span>
                    </div>
                    <div class="sidebar-item" onclick="showSection('gameWords')">
                        <span class="sidebar-icon">ğŸ“</span>
                        <span>ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</span>
                    </div>
                    <div class="sidebar-item" onclick="showSection('settings')">
                        <span class="sidebar-icon">âš™ï¸</span>
                        <span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
                    </div>
                </div>

                <!-- Content Area -->
                <div class="content-area">
                    <!-- Overview Section -->
                    <div id="overviewSection" class="section">
                        <div class="content-header">
                            <h2>Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</h2>
                        </div>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="totalEmployees">0</div>
                                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="activeEmployees">0</div>
                                <div class="stat-label">Ù…ÙˆØ¸ÙÙŠÙ† Ù†Ø´Ø·ÙŠÙ†</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="totalGames">0</div>
                                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="activeChallenges">0</div>
                                <div class="stat-label">ØªØ­Ø¯ÙŠØ§Øª Ù†Ø´Ø·Ø©</div>
                            </div>
                        </div>
                        
                        <h3 style="margin: 2rem 0 1rem;">Ù†Ø´Ø§Ø· Ø§Ù„ÙŠÙˆÙ…</h3>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Ø§Ù„Ù…ÙˆØ¸Ù</th>
                                        <th>Ø§Ù„Ù„Ø¹Ø¨Ø©</th>
                                        <th>Ø§Ù„Ù†ØªÙŠØ¬Ø©</th>
                                        <th>Ø§Ù„ÙˆÙ‚Øª</th>
                                    </tr>
                                </thead>
                                <tbody id="todayActivity">
                                    <tr>
                                        <td colspan="4" style="text-align:center;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ø´Ø§Ø· Ø§Ù„ÙŠÙˆÙ…</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Games Management Section -->
                    <div id="gamesManagementSection" class="section" style="display:none;">
                        <div class="content-header">
                            <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</h2>
                        </div>
                        
                        <div id="gamesStatusList">
                            <!-- Sudoku -->
                            <div class="game-status-card">
                                <div class="game-status-header">
                                    <div style="display: flex; align-items: center;">
                                        <span class="game-icon-large">ğŸ”¢</span>
                                        <div>
                                            <h3>Ø³ÙˆØ¯ÙˆÙƒÙˆ</h3>
                                            <div class="last-modified" id="sudoku-modified"></div>
                                        </div>
                                    </div>
                                    <label class="switch">
                                        <input type="checkbox" id="sudoku-switch" checked onchange="toggleGame('sudoku', this.checked)">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="game-hint-input" id="sudoku-hint-input">
                                    <label>ØªÙ„Ù…ÙŠØ­ Ù„Ù„Ø¹Ø¨Ø© Ù‚Ø±ÙŠØ¨Ø§Ù‹:</label>
                                    <input type="text" id="sudoku-hint" placeholder="Ù…Ø«Ø§Ù„: Ù„Ø¹Ø¨Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©..." value="Ù„Ø¹Ø¨Ø© Ø£Ø±Ù‚Ø§Ù… Ù…Ù†Ø·Ù‚ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©">
                                </div>
                            </div>

                            <!-- Tic Tac Toe -->
                            <div class="game-status-card">
                                <div class="game-status-header">
                                    <div style="display: flex; align-items: center;">
                                        <span class="game-icon-large">â­•</span>
                                        <div>
                                            <h3>Ø¥ÙƒØ³ Ø£Ùˆ</h3>
                                            <div class="last-modified" id="tictactoe-modified"></div>
                                        </div>
                                    </div>
                                    <label class="switch">
                                        <input type="checkbox" id="tictactoe-switch" checked onchange="toggleGame('tictactoe', this.checked)">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="game-hint-input" id="tictactoe-hint-input">
                                    <label>ØªÙ„Ù…ÙŠØ­ Ù„Ù„Ø¹Ø¨Ø© Ù‚Ø±ÙŠØ¨Ø§Ù‹:</label>
                                    <input type="text" id="tictactoe-hint" placeholder="Ù…Ø«Ø§Ù„: Ù„Ø¹Ø¨Ø© Ø«Ù†Ø§Ø¦ÙŠØ© Ù‚Ø§Ø¯Ù…Ø©..." value="Ù„Ø¹Ø¨Ø© Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø«Ù†Ø§Ø¦ÙŠØ©">
                                </div>
                            </div>

                            <!-- Hangman -->
                            <div class="game-status-card">
                                <div class="game-status-header">
                                    <div style="display: flex; align-items: center;">
                                        <span class="game-icon-large">ğŸ¯</span>
                                        <div>
                                            <h3>Ø§Ù„Ø±Ø¬Ù„ Ø§Ù„Ù…Ø´Ù†ÙˆÙ‚</h3>
                                            <div class="last-modified" id="hangman-modified"></div>
                                        </div>
                                    </div>
                                    <label class="switch">
                                        <input type="checkbox" id="hangman-switch" checked onchange="toggleGame('hangman', this.checked)">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="game-hint-input" id="hangman-hint-input">
                                    <label>ØªÙ„Ù…ÙŠØ­ Ù„Ù„Ø¹Ø¨Ø© Ù‚Ø±ÙŠØ¨Ø§Ù‹:</label>
                                    <input type="text" id="hangman-hint" placeholder="Ù…Ø«Ø§Ù„: Ù„Ø¹Ø¨Ø© ÙƒÙ„Ù…Ø§Øª Ù‚Ø§Ø¯Ù…Ø©..." value="Ù„Ø¹Ø¨Ø© ØªØ®Ù…ÙŠÙ† Ø§Ù„ÙƒÙ„Ù…Ø§Øª">
                                </div>
                            </div>

                            <!-- Crossword -->
                            <div class="game-status-card">
                                <div class="game-status-header">
                                    <div style="display: flex; align-items: center;">
                                        <span class="game-icon-large">ğŸ“°</span>
                                        <div>
                                            <h3>Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø§Ø·Ø¹Ø©</h3>
                                            <div class="last-modified" id="crossword-modified"></div>
                                        </div>
                                    </div>
                                    <label class="switch">
                                        <input type="checkbox" id="crossword-switch" checked onchange="toggleGame('crossword', this.checked)">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="game-hint-input" id="crossword-hint-input">
                                    <label>ØªÙ„Ù…ÙŠØ­ Ù„Ù„Ø¹Ø¨Ø© Ù‚Ø±ÙŠØ¨Ø§Ù‹:</label>
                                    <input type="text" id="crossword-hint" placeholder="Ù…Ø«Ø§Ù„: Ø£Ù„ØºØ§Ø² ÙƒÙ„Ù…Ø§Øª Ù‚Ø§Ø¯Ù…Ø©..." value="Ù„ØºØ² Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø§Ø·Ø¹Ø©">
                                </div>
                            </div>

                            <!-- Word Search -->
                            <div class="game-status-card">
                                <div class="game-status-header">
                                    <div style="display: flex; align-items: center;">
                                        <span class="game-icon-large">ğŸ”</span>
                                        <div>
                                            <h3>Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙƒÙ„Ù…Ø§Øª</h3>
                                            <div class="last-modified" id="wordsearch-modified"></div>
                                        </div>
                                    </div>
                                    <label class="switch">
                                        <input type="checkbox" id="wordsearch-switch" checked onchange="toggleGame('wordsearch', this.checked)">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="game-hint-input" id="wordsearch-hint-input">
                                    <label>ØªÙ„Ù…ÙŠØ­ Ù„Ù„Ø¹Ø¨Ø© Ù‚Ø±ÙŠØ¨Ø§Ù‹:</label>
                                    <input type="text" id="wordsearch-hint" placeholder="Ù…Ø«Ø§Ù„: Ù„Ø¹Ø¨Ø© Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙƒÙ„Ù…Ø§Øª..." value="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø®ÙÙŠØ©">
                                </div>
                            </div>
                        </div>

                        <div style="margin-top: 2rem;">
                            <button class="btn btn-success" onclick="saveGamesStatus()">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
                        </div>
                    </div>

                    <!-- Employees Section -->
                    <div id="employeesSection" class="section" style="display:none;">
                        <div class="content-header">
                            <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h2>
                        </div>
                        
                        <div class="file-upload" id="fileUpload">
                            <p style="font-size: 2rem; margin-bottom: 1rem;">ğŸ“</p>
                            <p>Ø§Ø³Ø­Ø¨ Ù…Ù„Ù Excel/CSV Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</p>
                            <input type="file" id="fileInput" accept=".csv,.xlsx,.xls" style="display:none;">
                        </div>
                        
                        <div id="uploadMessage"></div>
                        
                        <h3 style="margin: 2rem 0 1rem;">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù ÙŠØ¯ÙˆÙŠØ§Ù‹</h3>
                        <form id="addEmployeeForm">
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                                <div class="form-group">
                                    <label>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</label>
                                    <input type="text" id="empName" required>
                                </div>
                                <div class="form-group">
                                    <label>Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù (8 Ø£Ø±Ù‚Ø§Ù…)</label>
                                    <input type="text" id="empId" maxlength="8" pattern="[0-9]{8}" required>
                                </div>
                                <div class="form-group">
                                    <label>Ø§Ù„Ù‚Ø³Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                                    <input type="text" id="empDept">
                                </div>
                            </div>
                            <button type="submit" class="btn">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù</button>
                        </form>
                        
                        <h3 style="margin: 2rem 0 1rem;">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h3>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù</th>
                                        <th>Ø§Ù„Ø§Ø³Ù…</th>
                                        <th>Ø§Ù„Ù‚Ø³Ù…</th>
                                        <th>Ø­Ø§Ù„Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</th>
                                        <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                    </tr>
                                </thead>
                                <tbody id="employeesList">
                                    <tr>
                                        <td colspan="5" style="text-align:center;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Challenges Section -->
                    <div id="challengesSection" class="section" style="display:none;">
                        <div class="content-header">
                            <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª</h2>
                        </div>
                        
                        <div class="challenge-form">
                            <h3>Ø¥Ù†Ø´Ø§Ø¡ ØªØ­Ø¯ÙŠ Ø¬Ø¯ÙŠØ¯</h3>
                            <form id="createChallengeForm">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <div class="form-group">
                                        <label>Ø§Ù„Ù„Ø¹Ø¨Ø©</label>
                                        <select id="challengeGame" required>
                                            <option value="sudoku">Ø³ÙˆØ¯ÙˆÙƒÙˆ</option>
                                            <option value="tictactoe">Ø¥ÙƒØ³ Ø£Ùˆ</option>
                                            <option value="hangman">Ø§Ù„Ø±Ø¬Ù„ Ø§Ù„Ù…Ø´Ù†ÙˆÙ‚</option>
                                            <option value="crossword">Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø§Ø·Ø¹Ø©</option>
                                            <option value="wordsearch">Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙƒÙ„Ù…Ø§Øª</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø©</label>
                                        <select id="challengeDifficulty" required>
                                            <option value="easy">Ø³Ù‡Ù„</option>
                                            <option value="medium">Ù…ØªÙˆØ³Ø·</option>
                                            <option value="hard">ØµØ¹Ø¨</option>
                                            <option value="expert">Ø®Ø¨ÙŠØ±</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</label>
                                        <input type="datetime-local" id="challengeStart" required>
                                    </div>
                                    <div class="form-group">
                                        <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©</label>
                                        <input type="datetime-local" id="challengeEnd" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Ø§Ù„ÙˆØµÙ</label>
                                    <textarea id="challengeDescription" rows="3"></textarea>
                                </div>
                                <button type="submit" class="btn">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠ</button>
                            </form>
                        </div>
                        
                        <h3 style="margin: 2rem 0 1rem;">Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ù†Ø´Ø·Ø©</h3>
                        <div id="activeChallengesList"></div>
                        
                        <h3 style="margin: 2rem 0 1rem;">Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</h3>
                        <div id="pastChallengesList"></div>
                    </div>

                    <!-- Leaderboard Section -->
                    <div id="leaderboardSection" class="section" style="display:none;">
                        <div class="content-header">
                            <h2>Ù„ÙˆØ­Ø© Ø§Ù„ØµØ¯Ø§Ø±Ø©</h2>
                        </div>
                        
                        <div class="tabs">
                            <div class="tab active" onclick="showLeaderboardTab('all')">Ø§Ù„ÙƒÙ„</div>
                            <div class="tab" onclick="showLeaderboardTab('sudoku')">Ø³ÙˆØ¯ÙˆÙƒÙˆ</div>
                            <div class="tab" onclick="showLeaderboardTab('tictactoe')">Ø¥ÙƒØ³ Ø£Ùˆ</div>
                            <div class="tab" onclick="showLeaderboardTab('hangman')">Ø§Ù„Ø±Ø¬Ù„ Ø§Ù„Ù…Ø´Ù†ÙˆÙ‚</div>
                            <div class="tab" onclick="showLeaderboardTab('crossword')">Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø§Ø·Ø¹Ø©</div>
                            <div class="tab" onclick="showLeaderboardTab('wordsearch')">Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙƒÙ„Ù…Ø§Øª</div>
                            <div class="tab" onclick="showLeaderboardTab('challenges')">Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª</div>
                        </div>
                        
                        <!-- Challenge Filter Dropdown (shown only when challenges tab is active) -->
                        <div id="challengeFilterContainer" style="display:none; margin: 1rem 0;">
                            <div class="form-group" style="max-width: 400px;">
                                <label for="challengeFilter">Ø§Ø®ØªØ± Ø§Ù„ØªØ­Ø¯ÙŠ:</label>
                                <select id="challengeFilter" onchange="filterChallengeLeaderboard()">
                                    <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Ø§Ù„ØªØ±ØªÙŠØ¨</th>
                                        <th>Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù</th>
                                        <th>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</th>
                                        <th>Ø§Ù„Ù„Ø¹Ø¨Ø©</th>
                                        <th>Ø§Ù„ÙˆÙ‚Øª</th>
                                        <th>Ø§Ù„Ù†ØªÙŠØ¬Ø©</th>
                                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    </tr>
                                </thead>
                                <tbody id="leaderboardData">
                                    <tr>
                                        <td colspan="7" style="text-align:center;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Games Stats Section -->
                    <div id="gamesSection" class="section" style="display:none;">
                        <div class="content-header">
                            <h2>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</h2>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                            <div class="stat-card">
                                <h3>Ø³ÙˆØ¯ÙˆÙƒÙˆ</h3>
                                <p>Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</p>
                                <div class="stat-value" id="sudokuPlays">0</div>
                                <div class="stat-label">Ù…Ø±Ø© Ù„Ø¹Ø¨</div>
                            </div>
                            <div class="stat-card">
                                <h3>Ø¥ÙƒØ³ Ø£Ùˆ</h3>
                                <p>Ù„Ø¹Ø¨Ø© Ø«Ù†Ø§Ø¦ÙŠØ©</p>
                                <div class="stat-value" id="tictactoePlays">0</div>
                                <div class="stat-label">Ù…Ø±Ø© Ù„Ø¹Ø¨</div>
                            </div>
                            <div class="stat-card">
                                <h3>Ø§Ù„Ø±Ø¬Ù„ Ø§Ù„Ù…Ø´Ù†ÙˆÙ‚</h3>
                                <p>Ù„Ø¹Ø¨Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª</p>
                                <div class="stat-value" id="hangmanPlays">0</div>
                                <div class="stat-label">Ù…Ø±Ø© Ù„Ø¹Ø¨</div>
                            </div>
                            <div class="stat-card">
                                <h3>Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø§Ø·Ø¹Ø©</h3>
                                <p>Ø§Ù„Ø£Ù„ØºØ§Ø²</p>
                                <div class="stat-value" id="crosswordPlays">0</div>
                                <div class="stat-label">Ù…Ø±Ø© Ù„Ø¹Ø¨</div>
                            </div>
                            <div class="stat-card">
                                <h3>Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙƒÙ„Ù…Ø§Øª</h3>
                                <p>Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙƒÙ„Ù…Ø§Øª</p>
                                <div class="stat-value" id="wordsearchPlays">0</div>
                                <div class="stat-label">Ù…Ø±Ø© Ù„Ø¹Ø¨</div>
                            </div>
                        </div>
                        
                        <h3 style="margin: 2rem 0 1rem;">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</h3>
                        <div class="chart-container">
                            <canvas id="gamesChart"></canvas>
                        </div>
                    </div>

                    <!-- Game Words Section -->
                    <div id="gameWordsSection" class="section" style="display:none;">
                        <div class="content-header">
                            <h2>Ø¥Ø¯Ø§Ø±Ø© ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</h2>
                        </div>
                        
                        <!-- Hangman Words -->
                        <div class="game-word-form">
                            <h3>ÙƒÙ„Ù…Ø§Øª Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±Ø¬Ù„ Ø§Ù„Ù…Ø´Ù†ÙˆÙ‚</h3>
                            <form id="addHangmanWordForm">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <div class="form-group">
                                        <label>Ø§Ù„ÙƒÙ„Ù…Ø© Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</label>
                                        <input type="text" id="hangmanWordAr" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Ø§Ù„ÙƒÙ„Ù…Ø© Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</label>
                                        <input type="text" id="hangmanWordEn" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Ø§Ù„ØªÙ„Ù…ÙŠØ­ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</label>
                                        <input type="text" id="hangmanHintAr" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Ø§Ù„ØªÙ„Ù…ÙŠØ­ Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</label>
                                        <input type="text" id="hangmanHintEn" required>
                                    </div>
                                </div>
                                <button type="submit" class="btn">Ø¥Ø¶Ø§ÙØ© ÙƒÙ„Ù…Ø©</button>
                            </form>
                            
                            <h4 style="margin: 1.5rem 0 1rem;">Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h4>
                            <div id="hangmanWordsList"></div>
                        </div>
                        
                        <!-- Crossword Puzzles -->
                        <div class="game-word-form">
                            <h3>Ø£Ù„ØºØ§Ø² Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø§Ø·Ø¹Ø©</h3>
                            <form id="addCrosswordPuzzleForm">
                                <div class="form-group">
                                    <label>Ø§Ø³Ù… Ø§Ù„Ù„ØºØ²</label>
                                    <input type="text" id="crosswordName" required>
                                </div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <div class="form-group">
                                        <label>Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ø£ÙÙ‚ÙŠØ© Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</label>
                                        <textarea id="crosswordAcrossAr" rows="3" placeholder="ÙƒÙ„ Ø¯Ù„ÙŠÙ„ ÙÙŠ Ø³Ø·Ø± Ù…Ù†ÙØµÙ„"></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label>Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ø£ÙÙ‚ÙŠØ© Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</label>
                                        <textarea id="crosswordAcrossEn" rows="3" placeholder="Each clue on a separate line"></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label>Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠØ© Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</label>
                                        <textarea id="crosswordDownAr" rows="3" placeholder="ÙƒÙ„ Ø¯Ù„ÙŠÙ„ ÙÙŠ Ø³Ø·Ø± Ù…Ù†ÙØµÙ„"></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label>Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠØ© Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</label>
                                        <textarea id="crosswordDownEn" rows="3" placeholder="Each clue on a separate line"></textarea>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Ø´Ø¨ÙƒØ© Ø§Ù„Ù„ØºØ² (Ø§Ø³ØªØ®Ø¯Ù… # Ù„Ù„Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ø³ÙˆØ¯Ø§Ø¡)</label>
                                    <textarea id="crosswordGrid" rows="5" placeholder="Ù…Ø«Ø§Ù„:
COMP#
O###T
D###E
E###R" style="font-family: monospace;"></textarea>
                                </div>
                                <button type="submit" class="btn">Ø¥Ø¶Ø§ÙØ© Ù„ØºØ²</button>
                            </form>
                            
                            <h4 style="margin: 1.5rem 0 1rem;">Ø§Ù„Ø£Ù„ØºØ§Ø² Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h4>
                            <div id="crosswordPuzzlesList"></div>
                        </div>
                        
                        <!-- Word Search Words -->
                        <div class="game-word-form">
                            <h3>ÙƒÙ„Ù…Ø§Øª Ù„Ø¹Ø¨Ø© Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙƒÙ„Ù…Ø§Øª</h3>
                            <form id="addWordsearchWordForm">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <div class="form-group">
                                        <label>Ø§Ù„ÙƒÙ„Ù…Ø© Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</label>
                                        <input type="text" id="wordsearchWordAr" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Ø§Ù„ÙƒÙ„Ù…Ø© Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</label>
                                        <input type="text" id="wordsearchWordEn" required>
                                    </div>
                                </div>
                                <button type="submit" class="btn">Ø¥Ø¶Ø§ÙØ© ÙƒÙ„Ù…Ø©</button>
                            </form>
                            
                            <h4 style="margin: 1.5rem 0 1rem;">Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h4>
                            <div id="wordsearchWordsList"></div>
                        </div>
                    </div>

                    <!-- Settings Section -->
                    <div id="settingsSection" class="section" style="display:none;">
                        <div class="content-header">
                            <h2>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
                        </div>
                        
                        <h3>Ø´Ø¹Ø§Ø± Ø§Ù„Ø´Ø±ÙƒØ©</h3>
                        <div class="form-group">
                            <label>Ø±ÙØ¹ Ø§Ù„Ø´Ø¹Ø§Ø± (Base64)</label>
                            <input type="file" id="logoInput" accept="image/*">
                            <img id="logoPreview" class="logo-preview" style="display:none;">
                        </div>
                        <button class="btn" onclick="saveLogo()">Ø­ÙØ¸ Ø§Ù„Ø´Ø¹Ø§Ø±</button>
                        
                        <h3 style="margin: 2rem 0 1rem;">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯Ø±Ø§Ø¡</h3>
                        <form id="addAdminForm">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div class="form-group">
                                    <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                                    <input type="email" id="adminEmail" required>
                                </div>
                                <div class="form-group">
                                    <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                                    <input type="password" id="adminPassword" required>
                                </div>
                            </div>
                            <button type="submit" class="btn">Ø¥Ø¶Ø§ÙØ© Ù…Ø¯ÙŠØ±</button>
                        </form>
                        
                        <h3 style="margin: 2rem 0 1rem;">Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙˆØ§Ù„ØªØµØ¯ÙŠØ±</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                            <button class="btn btn-success" onclick="exportEmployees()">ØªØµØ¯ÙŠØ± Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</button>
                            <button class="btn btn-success" onclick="exportGameResults()">ØªØµØ¯ÙŠØ± Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</button>
                            <button class="btn btn-success" onclick="exportChallenges()">ØªØµØ¯ÙŠØ± Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª</button>
                            <button class="btn btn-success" onclick="exportAllData()">ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                        </div>
                        <br>
                        <button class="btn btn-warning" onclick="resetPasswords()">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <div class="modal-header" id="modalTitle"></div>
            <div id="modalBody"></div>
        </div>
    </div>

    <!-- Firebase & Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
        import { 
            getAuth, 
            signInWithEmailAndPassword,
            createUserWithEmailAndPassword,
            signOut,
            onAuthStateChanged
        } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js';
        import { 
            getFirestore, 
            collection, 
            doc, 
            getDoc, 
            setDoc, 
            updateDoc, 
            deleteDoc,
            query, 
            where, 
            orderBy, 
            limit, 
            getDocs,
            addDoc,
            serverTimestamp,
            writeBatch
        } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyD_hyXMW8qg1BwtJdykoo4XFLDoAwsXxGY",
            authDomain: "dar-wa-emaar-game-center.firebaseapp.com",
            projectId: "dar-wa-emaar-game-center",
            storageBucket: "dar-wa-emaar-game-center.firebasestorage.app",
            messagingSenderId: "788128481095",
            appId: "1:788128481095:web:50c85945e619a69a9f5662",
            measurementId: "G-LRBZ9QLMZ2"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.auth = auth;
        window.db = db;
        window.firestore = {
            collection,
            doc,
            getDoc,
            setDoc,
            updateDoc,
            deleteDoc,
            query,
            where,
            orderBy,
            limit,
            getDocs,
            addDoc,
            serverTimestamp,
            writeBatch
        };
        window.authFunctions = {
            signInWithEmailAndPassword,
            createUserWithEmailAndPassword,
            signOut
        };

        // Check auth state
        onAuthStateChanged(auth, (user) => {
            if (user) {
                window.currentAdmin = user;
                loginSuccess();
            } else {
                window.currentAdmin = null;
                document.getElementById('authContainer').style.display = 'block';
                document.getElementById('dashboard').style.display = 'none';
            }
        });

        // Load initial data
        loadCompanyLogo();
        loadGamesStatus();
    </script>

    <script>
        let currentAdmin = null;
        let gamesChart = null;

        // Auth form handler
        document.getElementById('authForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            showLoading(true);

            try {
                const userCredential = await window.authFunctions.signInWithEmailAndPassword(
                    window.auth, 
                    email, 
                    password
                );
                currentAdmin = userCredential.user;
                loginSuccess();
            } catch (error) {
                console.error('Login error:', error);
                showMessage('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ' + getErrorMessage(error.code), 'error');
                showLoading(false);
            }
        });

        function getErrorMessage(code) {
            const messages = {
                'auth/invalid-email': 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­',
                'auth/user-not-found': 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯',
                'auth/wrong-password': 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©',
                'auth/user-disabled': 'Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ø¹Ø·Ù„'
            };
            return messages[code] || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹';
        }

        function loginSuccess() {
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            document.getElementById('logoutBtn').style.display = 'block';
            
            loadDashboardData();
            loadGamesStatus();
            showSection('overview');
            showLoading(false);
        }

        async function logout() {
            try {
                await window.authFunctions.signOut(window.auth);
                currentAdmin = null;
                document.getElementById('authContainer').style.display = 'block';
                document.getElementById('dashboard').style.display = 'none';
                document.getElementById('logoutBtn').style.display = 'none';
                document.getElementById('authForm').reset();
            } catch (error) {
                console.error('Logout error:', error);
            }
        }

        // Games Management Functions
        async function loadGamesStatus() {
            try {
                const gamesDoc = await window.firestore.getDoc(
                    window.firestore.doc(window.db, 'settings', 'games')
                );
                
                if (gamesDoc.exists()) {
                    const data = gamesDoc.data();
                    
                    // Set game switches
                    document.getElementById('sudoku-switch').checked = data.sudoku?.active !== false;
                    document.getElementById('tictactoe-switch').checked = data.tictactoe?.active !== false;
                    document.getElementById('hangman-switch').checked = data.hangman?.active !== false;
                    document.getElementById('crossword-switch').checked = data.crossword?.active !== false;
                    document.getElementById('wordsearch-switch').checked = data.wordsearch?.active !== false;
                    
                    // Set hints
                    if (data.sudoku?.hint) document.getElementById('sudoku-hint').value = data.sudoku.hint;
                    if (data.tictactoe?.hint) document.getElementById('tictactoe-hint').value = data.tictactoe.hint;
                    if (data.hangman?.hint) document.getElementById('hangman-hint').value = data.hangman.hint;
                    if (data.crossword?.hint) document.getElementById('crossword-hint').value = data.crossword.hint;
                    if (data.wordsearch?.hint) document.getElementById('wordsearch-hint').value = data.wordsearch.hint;
                    
                    // Show last modified
                    updateLastModified('sudoku', data.sudoku);
                    updateLastModified('tictactoe', data.tictactoe);
                    updateLastModified('hangman', data.hangman);
                    updateLastModified('crossword', data.crossword);
                    updateLastModified('wordsearch', data.wordsearch);
                    
                    // Update hint inputs visibility
                    toggleGame('sudoku', document.getElementById('sudoku-switch').checked);
                    toggleGame('tictactoe', document.getElementById('tictactoe-switch').checked);
                    toggleGame('hangman', document.getElementById('hangman-switch').checked);
                    toggleGame('crossword', document.getElementById('crossword-switch').checked);
                    toggleGame('wordsearch', document.getElementById('wordsearch-switch').checked);
                }
            } catch (error) {
                console.error('Error loading games status:', error);
            }
        }

        function updateLastModified(game, data) {
            const element = document.getElementById(`${game}-modified`);
            if (element && data?.lastModified) {
                const date = data.lastModified.toDate ? data.lastModified.toDate() : new Date(data.lastModified);
                element.textContent = `Ø¢Ø®Ø± ØªØ¹Ø¯ÙŠÙ„: ${date.toLocaleDateString('en-US')} Ø¨ÙˆØ§Ø³Ø·Ø© ${data.lastModifiedBy || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}`;
            }
        }

        function toggleGame(game, isActive) {
            const hintInput = document.getElementById(`${game}-hint-input`);
            if (hintInput) {
                hintInput.style.display = isActive ? 'none' : 'block';
            }
        }

        async function saveGamesStatus() {
            showLoading(true);
            
            const admin = currentAdmin || window.currentAdmin;
            if (!admin) {
                showMessage('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
                showLoading(false);
                return;
            }
            
            try {
                const gamesData = {
                    sudoku: {
                        active: document.getElementById('sudoku-switch').checked,
                        hint: document.getElementById('sudoku-hint').value,
                        lastModified: window.firestore.serverTimestamp(),
                        lastModifiedBy: admin.email
                    },
                    tictactoe: {
                        active: document.getElementById('tictactoe-switch').checked,
                        hint: document.getElementById('tictactoe-hint').value,
                        lastModified: window.firestore.serverTimestamp(),
                        lastModifiedBy: admin.email
                    },
                    hangman: {
                        active: document.getElementById('hangman-switch').checked,
                        hint: document.getElementById('hangman-hint').value,
                        lastModified: window.firestore.serverTimestamp(),
                        lastModifiedBy: admin.email
                    },
                    crossword: {
                        active: document.getElementById('crossword-switch').checked,
                        hint: document.getElementById('crossword-hint').value,
                        lastModified: window.firestore.serverTimestamp(),
                        lastModifiedBy: admin.email
                    },
                    wordsearch: {
                        active: document.getElementById('wordsearch-switch').checked,
                        hint: document.getElementById('wordsearch-hint').value,
                        lastModified: window.firestore.serverTimestamp(),
                        lastModifiedBy: admin.email
                    }
                };
                
                await window.firestore.setDoc(
                    window.firestore.doc(window.db, 'settings', 'games'),
                    gamesData,
                    { merge: true }
                );
                
                showMessage('ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                loadGamesStatus(); // Reload to show updated last modified info
            } catch (error) {
                console.error('Error saving games status:', error);
                showMessage('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª', 'error');
            }
            
            showLoading(false);
        }

        // Section navigation
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.style.display = 'none';
            });
            
            // Show selected section
            document.getElementById(`${sectionName}Section`).style.display = 'block';
            
            // Update sidebar active state
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.sidebar-item').classList.add('active');
            
            // Load section data
            switch(sectionName) {
                case 'overview':
                    loadDashboardData();
                    break;
                case 'gamesManagement':
                    loadGamesStatus();
                    break;
                case 'employees':
                    loadEmployees();
                    break;
                case 'challenges':
                    loadChallenges();
                    break;
                case 'leaderboard':
                    loadLeaderboard('all');
                    break;
                case 'games':
                    loadGamesStats();
                    break;
                case 'gameWords':
                    loadGameWords();
                    break;
            }
        }

        // Load dashboard data
        async function loadDashboardData() {
            try {
                // Get employees count
                const employeesSnapshot = await window.firestore.getDocs(
                    window.firestore.collection(window.db, 'employees')
                );
                document.getElementById('totalEmployees').textContent = employeesSnapshot.size;
                
                // Get active employees (with password)
                let activeCount = 0;
                employeesSnapshot.forEach(doc => {
                    if (doc.data().password) activeCount++;
                });
                document.getElementById('activeEmployees').textContent = activeCount;
                
                // Get games played today
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                const gamesQuery = window.firestore.query(
                    window.firestore.collection(window.db, 'gameResults'),
                    window.firestore.where('timestamp', '>=', today),
                    window.firestore.orderBy('timestamp', 'desc'),
                    window.firestore.limit(10)
                );
                
                const gamesSnapshot = await window.firestore.getDocs(gamesQuery);
                document.getElementById('totalGames').textContent = gamesSnapshot.size;
                
                // Update today's activity table
                const tbody = document.getElementById('todayActivity');
                if (gamesSnapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ø´Ø§Ø· Ø§Ù„ÙŠÙˆÙ…</td></tr>';
                } else {
                    tbody.innerHTML = '';
                    gamesSnapshot.forEach(doc => {
                        const data = doc.data();
                        const row = tbody.insertRow();
                        row.innerHTML = `
                            <td>${data.employeeName || data.employeeId}</td>
                            <td>${getGameName(data.game)}</td>
                            <td>${getResultText(data.result)}</td>
                            <td>${formatTime(data.time)}</td>
                        `;
                    });
                }
                
                // Get active challenges
                const now = new Date();
                const challengesQuery = window.firestore.query(
                    window.firestore.collection(window.db, 'challenges'),
                    window.firestore.where('endDate', '>', now.toISOString())
                );
                const challengesSnapshot = await window.firestore.getDocs(challengesQuery);
                
                let activeChallengesCount = 0;
                challengesSnapshot.forEach(doc => {
                    const data = doc.data();
                    if (new Date(data.startDate) <= now) {
                        activeChallengesCount++;
                    }
                });
                document.getElementById('activeChallenges').textContent = activeChallengesCount;
                
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }

        // File upload handling
        const fileUpload = document.getElementById('fileUpload');
        const fileInput = document.getElementById('fileInput');

        fileUpload.addEventListener('click', () => fileInput.click());
        fileUpload.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUpload.classList.add('dragging');
        });
        fileUpload.addEventListener('dragleave', () => {
            fileUpload.classList.remove('dragging');
        });
        fileUpload.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUpload.classList.remove('dragging');
            handleFiles(e.dataTransfer.files);
        });
        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        async function handleFiles(files) {
            if (files.length === 0) return;
            
            const file = files[0];
            const reader = new FileReader();
            
            showLoading(true);
            
            reader.onload = async (e) => {
                try {
                    let data;
                    
                    if (file.name.endsWith('.csv')) {
                        // Parse CSV
                        const text = e.target.result;
                        data = parseCSV(text);
                    } else {
                        // Parse Excel
                        const workbook = XLSX.read(e.target.result, { type: 'binary' });
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        data = XLSX.utils.sheet_to_json(firstSheet);
                    }
                    
                    // Process and save employees
                    await saveEmployees(data);
                    
                } catch (error) {
                    console.error('File processing error:', error);
                    showUploadMessage('Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„Ù', 'error');
                    showLoading(false);
                }
            };
            
            if (file.name.endsWith('.csv')) {
                reader.readAsText(file);
            } else {
                reader.readAsBinaryString(file);
            }
        }

        function parseCSV(text) {
            const lines = text.split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim()) {
                    const values = lines[i].split(',').map(v => v.trim());
                    const row = {};
                    headers.forEach((header, index) => {
                        row[header] = values[index];
                    });
                    data.push(row);
                }
            }
            
            return data;
        }

        async function saveEmployees(data) {
            const batch = window.firestore.writeBatch(window.db);
            let successCount = 0;
            let errorCount = 0;
            
            for (const row of data) {
                const employeeId = row['ID'] || row['EmployeeID'] || row['Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù'];
                const name = row['Name'] || row['EmployeeName'] || row['Ø§Ù„Ø§Ø³Ù…'];
                const department = row['Department'] || row['Ø§Ù„Ù‚Ø³Ù…'] || '';
                
                if (employeeId && name) {
                    // Validate ID is 8 digits
                    if (/^\d{8}$/.test(employeeId.toString())) {
                        const docRef = window.firestore.doc(window.db, 'employees', employeeId.toString());
                        batch.set(docRef, {
                            name: name,
                            department: department,
                            createdAt: window.firestore.serverTimestamp()
                        }, { merge: true });
                        successCount++;
                    } else {
                        errorCount++;
                    }
                }
            }
            
            if (successCount > 0) {
                await batch.commit();
                showUploadMessage(`ØªÙ… Ø¥Ø¶Ø§ÙØ© ${successCount} Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­${errorCount > 0 ? ` (${errorCount} Ø®Ø·Ø£)` : ''}`, 'success');
                loadEmployees();
            } else {
                showUploadMessage('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø©', 'error');
            }
            
            showLoading(false);
        }

        // Add employee manually
        document.getElementById('addEmployeeForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('empName').value;
            const id = document.getElementById('empId').value;
            const department = document.getElementById('empDept').value;
            
            if (!/^\d{8}$/.test(id)) {
                showMessage('Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 8 Ø£Ø±Ù‚Ø§Ù…', 'error');
                return;
            }
            
            showLoading(true);
            
            try {
                await window.firestore.setDoc(
                    window.firestore.doc(window.db, 'employees', id),
                    {
                        name: name,
                        department: department,
                        createdAt: window.firestore.serverTimestamp()
                    },
                    { merge: true }
                );
                
                showMessage('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­', 'success');
                document.getElementById('addEmployeeForm').reset();
                loadEmployees();
            } catch (error) {
                console.error('Error adding employee:', error);
                showMessage('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù', 'error');
            }
            
            showLoading(false);
        });

        // Load employees
        async function loadEmployees() {
            try {
                const snapshot = await window.firestore.getDocs(
                    window.firestore.collection(window.db, 'employees')
                );
                
                const tbody = document.getElementById('employeesList');
                tbody.innerHTML = '';
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${doc.id}</td>
                        <td>${data.name}</td>
                        <td>${data.department || '-'}</td>
                        <td>${data.password ? '<span style="color:var(--success)">âœ“ ØªÙ… Ø§Ù„ØªØ¹ÙŠÙŠÙ†</span>' : '<span style="color:var(--warning)">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø±</span>'}</td>
                        <td class="action-buttons">
                            <button class="btn btn-icon btn-warning" onclick="resetEmployeePassword('${doc.id}')">ğŸ”„</button>
                            <button class="btn btn-icon btn-danger" onclick="deleteEmployee('${doc.id}')">ğŸ—‘ï¸</button>
                        </td>
                    `;
                });
            } catch (error) {
                console.error('Error loading employees:', error);
            }
        }

        async function resetEmployeePassword(id) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ')) return;
            
            try {
                await window.firestore.updateDoc(
                    window.firestore.doc(window.db, 'employees', id),
                    { password: null }
                );
                showMessage('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', 'success');
                loadEmployees();
            } catch (error) {
                console.error('Error resetting password:', error);
            }
        }

        async function deleteEmployee(id) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¸ÙØŸ')) return;
            
            try {
                await window.firestore.deleteDoc(
                    window.firestore.doc(window.db, 'employees', id)
                );
                showMessage('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù', 'success');
                loadEmployees();
            } catch (error) {
                console.error('Error deleting employee:', error);
            }
        }

        // Create challenge
        document.getElementById('createChallengeForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const game = document.getElementById('challengeGame').value;
            const difficulty = document.getElementById('challengeDifficulty').value;
            const startDate = new Date(document.getElementById('challengeStart').value);
            const endDate = new Date(document.getElementById('challengeEnd').value);
            const description = document.getElementById('challengeDescription').value;
            
            if (endDate <= startDate) {
                showMessage('ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨Ø¹Ø¯ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©', 'error');
                return;
            }
            
            const admin = currentAdmin || window.currentAdmin;
            if (!admin) {
                showMessage('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
                return;
            }
            
            showLoading(true);
            
            try {
                await window.firestore.addDoc(
                    window.firestore.collection(window.db, 'challenges'),
                    {
                        game: game,
                        difficulty: difficulty,
                        startDate: startDate.toISOString(),
                        endDate: endDate.toISOString(),
                        description: description,
                        createdAt: window.firestore.serverTimestamp(),
                        createdBy: admin.email
                    }
                );
                
                showMessage('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                document.getElementById('createChallengeForm').reset();
                loadChallenges();
            } catch (error) {
                console.error('Error creating challenge:', error);
                showMessage('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠ', 'error');
            }
            
            showLoading(false);
        });

        // Load challenges
        async function loadChallenges() {
            try {
                const now = new Date();
                
                // Active challenges
                const activeQuery = window.firestore.query(
                    window.firestore.collection(window.db, 'challenges'),
                    window.firestore.where('endDate', '>', now.toISOString()),
                    window.firestore.orderBy('endDate', 'asc')
                );
                
                const activeSnapshot = await window.firestore.getDocs(activeQuery);
                const activeList = document.getElementById('activeChallengesList');
                activeList.innerHTML = '';
                
                if (activeSnapshot.empty) {
                    activeList.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ­Ø¯ÙŠØ§Øª Ù†Ø´Ø·Ø©</p>';
                } else {
                    for (const doc of activeSnapshot.docs) {
                        const data = doc.data();
                        const startDate = new Date(data.startDate);
                        const endDate = new Date(data.endDate);
                        const isStarted = startDate <= now;
                        
                        // Calculate days remaining
                        const daysRemaining = Math.ceil((endDate - now) / (1000 * 60 * 60 * 24));
                        
                        // Get participant count for this challenge
                        const participantsQuery = window.firestore.query(
                            window.firestore.collection(window.db, 'gameResults'),
                            window.firestore.where('challengeId', '==', doc.id)
                        );
                        const participantsSnapshot = await window.firestore.getDocs(participantsQuery);
                        const participantCount = participantsSnapshot.size;
                        
                        const card = document.createElement('div');
                        card.className = 'challenge-card';
                        card.innerHTML = `
                            <h3>ØªØ­Ø¯ÙŠ ${getGameName(data.game)}</h3>
                            <div class="challenge-info">
                                <div class="challenge-info-item">
                                    <div class="challenge-info-label">Ø§Ù„ØµØ¹ÙˆØ¨Ø©</div>
                                    <div class="challenge-info-value">${getDifficultyName(data.difficulty)}</div>
                                </div>
                                <div class="challenge-info-item">
                                    <div class="challenge-info-label">Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</div>
                                    <div class="challenge-info-value">${startDate.toLocaleDateString('en-US')}</div>
                                </div>
                                <div class="challenge-info-item">
                                    <div class="challenge-info-label">Ø§Ù„Ù†Ù‡Ø§ÙŠØ©</div>
                                    <div class="challenge-info-value">${endDate.toLocaleDateString('en-US')}</div>
                                </div>
                                <div class="challenge-info-item">
                                    <div class="challenge-info-label">Ø§Ù„Ø­Ø§Ù„Ø©</div>
                                    <div class="challenge-info-value">
                                        ${isStarted ? '<span style="color: var(--success);">Ù†Ø´Ø·</span>' : '<span style="color: var(--warning);">Ù„Ù… ÙŠØ¨Ø¯Ø£ Ø¨Ø¹Ø¯</span>'}
                                    </div>
                                </div>
                                <div class="challenge-info-item">
                                    <div class="challenge-info-label">Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙˆÙ†</div>
                                    <div class="challenge-info-value">${participantCount}</div>
                                </div>
                                <div class="challenge-info-item">
                                    <div class="challenge-info-label">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</div>
                                    <div class="challenge-info-value">
                                        <span class="days-remaining">${daysRemaining} ÙŠÙˆÙ…</span>
                                    </div>
                                </div>
                            </div>
                            ${data.description ? `<p style="margin-top: 1rem;">${data.description}</p>` : ''}
                            <div style="margin-top: 1rem;">
                                <button class="btn btn-success btn-icon" onclick="viewChallengeParticipants('${doc.id}', '${data.game}')">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†</button>
                                <button class="btn btn-danger btn-icon" onclick="deleteChallenge('${doc.id}')">Ø­Ø°Ù</button>
                            </div>
                        `;
                        activeList.appendChild(card);
                    }
                }
                
                // Past challenges
                const pastQuery = window.firestore.query(
                    window.firestore.collection(window.db, 'challenges'),
                    window.firestore.where('endDate', '<=', now.toISOString()),
                    window.firestore.orderBy('endDate', 'desc'),
                    window.firestore.limit(10)
                );
                
                const pastSnapshot = await window.firestore.getDocs(pastQuery);
                const pastList = document.getElementById('pastChallengesList');
                pastList.innerHTML = '';
                
                if (pastSnapshot.empty) {
                    pastList.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ­Ø¯ÙŠØ§Øª Ø³Ø§Ø¨Ù‚Ø©</p>';
                } else {
                    for (const doc of pastSnapshot.docs) {
                        const data = doc.data();
                        
                        // Get participant count
                        const participantsQuery = window.firestore.query(
                            window.firestore.collection(window.db, 'gameResults'),
                            window.firestore.where('challengeId', '==', doc.id)
                        );
                        const participantsSnapshot = await window.firestore.getDocs(participantsQuery);
                        const participantCount = participantsSnapshot.size;
                        
                        const card = document.createElement('div');
                        card.className = 'stat-card';
                        card.innerHTML = `
                            <h4>${getGameName(data.game)} - ${getDifficultyName(data.difficulty)}</h4>
                            <p>${data.description || 'Ø¨Ø¯ÙˆÙ† ÙˆØµÙ'}</p>
                            <p>Ø§Ù†ØªÙ‡Ù‰: ${new Date(data.endDate).toLocaleDateString('en-US')}</p>
                            <p style="color: var(--primary-color);">Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙˆÙ†: ${participantCount}</p>
                            <button class="btn btn-success" onclick="viewChallengeParticipants('${doc.id}', '${data.game}')">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† ÙˆØ§Ù„ÙØ§Ø¦Ø²</button>
                        `;
                        pastList.appendChild(card);
                    }
                }
                
            } catch (error) {
                console.error('Error loading challenges:', error);
            }
        }
        
        async function viewChallengeParticipants(challengeId, gameName) {
            try {
                const participantsQuery = window.firestore.query(
                    window.firestore.collection(window.db, 'gameResults'),
                    window.firestore.where('challengeId', '==', challengeId),
                    window.firestore.orderBy('time', 'asc')
                );
                
                const snapshot = await window.firestore.getDocs(participantsQuery);
                
                if (snapshot.empty) {
                    showModal('Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙˆÙ†', 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙƒÙˆÙ† ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØªØ­Ø¯ÙŠ Ø¨Ø¹Ø¯');
                    return;
                }
                
                let tableHTML = `
                    <h3>Ù…Ø´Ø§Ø±ÙƒÙˆ ØªØ­Ø¯ÙŠ ${getGameName(gameName)}</h3>
                    <table style="width: 100%; margin-top: 1rem;">
                        <thead>
                            <tr style="background: var(--primary-color); color: white;">
                                <th style="padding: 0.5rem;">Ø§Ù„ØªØ±ØªÙŠØ¨</th>
                                <th style="padding: 0.5rem;">Ø§Ù„Ù…ÙˆØ¸Ù</th>
                                <th style="padding: 0.5rem;">Ø§Ù„ÙˆÙ‚Øª</th>
                                <th style="padding: 0.5rem;">Ø§Ù„Ù†ØªÙŠØ¬Ø©</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                let rank = 1;
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const isWinner = rank === 1;
                    const rowStyle = isWinner ? 'background: gold; font-weight: bold;' : '';
                    tableHTML += `
                        <tr style="${rowStyle}">
                            <td style="padding: 0.5rem; text-align: center;">
                                ${isWinner ? 'ğŸ† ' : ''}${rank++}
                            </td>
                            <td style="padding: 0.5rem;">${data.employeeName || data.employeeId}</td>
                            <td style="padding: 0.5rem;">${formatTime(data.time)}</td>
                            <td style="padding: 0.5rem;">${getResultText(data.result)}</td>
                        </tr>
                    `;
                });
                
                tableHTML += `
                        </tbody>
                    </table>
                `;
                
                showModal('Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙˆÙ† ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠ', tableHTML);
            } catch (error) {
                console.error('Error viewing participants:', error);
                showModal('Ø®Ø·Ø£', 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†');
            }
        }

        async function deleteChallenge(id) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ­Ø¯ÙŠØŸ')) return;
            
            try {
                await window.firestore.deleteDoc(
                    window.firestore.doc(window.db, 'challenges', id)
                );
                showMessage('ØªÙ… Ø­Ø°Ù Ø§Ù„ØªØ­Ø¯ÙŠ', 'success');
                loadChallenges();
            } catch (error) {
                console.error('Error deleting challenge:', error);
            }
        }

        // Leaderboard
        function showLeaderboardTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            // Show/hide challenge filter dropdown
            const challengeFilterContainer = document.getElementById('challengeFilterContainer');
            if (tab === 'challenges') {
                challengeFilterContainer.style.display = 'block';
                loadChallengesList(); // Load challenges for dropdown
            } else {
                challengeFilterContainer.style.display = 'none';
            }
            
            loadLeaderboard(tab);
        }

        async function loadChallengesList() {
            try {
                // Get all challenges for the dropdown
                const challengesSnapshot = await window.firestore.getDocs(
                    window.firestore.query(
                        window.firestore.collection(window.db, 'challenges'),
                        window.firestore.orderBy('endDate', 'desc')
                    )
                );
                
                const select = document.getElementById('challengeFilter');
                select.innerHTML = '<option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª</option>';
                
                challengesSnapshot.forEach(doc => {
                    const data = doc.data();
                    const startDate = new Date(data.startDate);
                    const endDate = new Date(data.endDate);
                    const now = new Date();
                    const isActive = startDate <= now && endDate > now;
                    const status = isActive ? 'ğŸŸ¢' : 'ğŸ”´';
                    
                    const option = document.createElement('option');
                    option.value = doc.id;
                    option.textContent = `${status} ${getGameName(data.game)} - ${getDifficultyName(data.difficulty)} (${startDate.toLocaleDateString('en-US')} - ${endDate.toLocaleDateString('en-US')})`;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading challenges list:', error);
            }
        }

        async function filterChallengeLeaderboard() {
            const selectedChallenge = document.getElementById('challengeFilter').value;
            
            if (selectedChallenge === 'all') {
                loadLeaderboard('challenges');
            } else {
                // Load specific challenge leaderboard
                await loadSpecificChallengeLeaderboard(selectedChallenge);
            }
        }

        async function loadSpecificChallengeLeaderboard(challengeId) {
            try {
                // First get challenge details
                const challengeDoc = await window.firestore.getDoc(
                    window.firestore.doc(window.db, 'challenges', challengeId)
                );
                
                if (!challengeDoc.exists()) {
                    showMessage('Ø§Ù„ØªØ­Ø¯ÙŠ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                    return;
                }
                
                const challengeData = challengeDoc.data();
                
                // Get participants for this specific challenge
                const participantsQuery = window.firestore.query(
                    window.firestore.collection(window.db, 'gameResults'),
                    window.firestore.where('challengeId', '==', challengeId),
                    window.firestore.orderBy('time', 'asc')
                );
                
                const snapshot = await window.firestore.getDocs(participantsQuery);
                const tbody = document.getElementById('leaderboardData');
                tbody.innerHTML = '';
                
                if (snapshot.empty) {
                    tbody.innerHTML = `<tr><td colspan="7" style="text-align:center;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙƒÙˆÙ† ÙÙŠ ØªØ­Ø¯ÙŠ ${getGameName(challengeData.game)} - ${getDifficultyName(challengeData.difficulty)}</td></tr>`;
                } else {
                    let rank = 1;
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        const dateStr = data.timestamp ? 
                            new Date(data.timestamp.seconds * 1000).toLocaleDateString('en-US') : '-';
                        const row = tbody.insertRow();
                        
                        // Highlight winner (rank 1)
                        if (rank === 1) {
                            row.style.background = 'linear-gradient(90deg, rgba(255,215,0,0.2) 0%, rgba(255,215,0,0.1) 100%)';
                            row.style.fontWeight = 'bold';
                        }
                        
                        row.innerHTML = `
                            <td>${rank === 1 ? 'ğŸ† ' : ''}${rank++}</td>
                            <td>${data.employeeId}</td>
                            <td>${data.employeeName || data.employeeId}</td>
                            <td>${getGameName(data.game)} ${rank === 1 ? 'ğŸ…' : ''}</td>
                            <td>${formatTime(data.time)}</td>
                            <td>${getResultText(data.result)}</td>
                            <td>${dateStr}</td>
                        `;
                    });
                    
                    // Add challenge info at the bottom
                    const infoRow = tbody.insertRow();
                    infoRow.innerHTML = `
                        <td colspan="7" style="text-align:center; padding: 1rem; background: var(--bg-color); font-style: italic;">
                            ØªØ­Ø¯ÙŠ ${getGameName(challengeData.game)} - Ù…Ø³ØªÙˆÙ‰ ${getDifficultyName(challengeData.difficulty)} 
                            (${new Date(challengeData.startDate).toLocaleDateString('en-US')} - ${new Date(challengeData.endDate).toLocaleDateString('en-US')})
                            ${challengeData.description ? ' - ' + challengeData.description : ''}
                        </td>
                    `;
                }
            } catch (error) {
                console.error('Error loading specific challenge leaderboard:', error);
                showMessage('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ø¯ÙŠ', 'error');
            }
        }

        async function loadLeaderboard(filter) {
            try {
                let q;
                
                if (filter === 'all') {
                    q = window.firestore.query(
                        window.firestore.collection(window.db, 'gameResults'),
                        window.firestore.orderBy('time', 'asc'),
                        window.firestore.limit(50)
                    );
                } else if (filter === 'challenges') {
                    // Check if a specific challenge is selected
                    const selectedChallenge = document.getElementById('challengeFilter')?.value;
                    if (selectedChallenge && selectedChallenge !== 'all') {
                        await loadSpecificChallengeLeaderboard(selectedChallenge);
                        return;
                    }
                    
                    // Load all challenge participation data
                    q = window.firestore.query(
                        window.firestore.collection(window.db, 'gameResults'),
                        window.firestore.where('isChallenge', '==', true),
                        window.firestore.orderBy('time', 'asc'),
                        window.firestore.limit(50)
                    );
                } else {
                    q = window.firestore.query(
                        window.firestore.collection(window.db, 'gameResults'),
                        window.firestore.where('game', '==', filter),
                        window.firestore.orderBy('time', 'asc'),
                        window.firestore.limit(50)
                    );
                }
                
                const snapshot = await window.firestore.getDocs(q);
                const tbody = document.getElementById('leaderboardData');
                tbody.innerHTML = '';
                
                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</td></tr>';
                } else {
                    // Group results by challenge if viewing all challenges
                    if (filter === 'challenges' && (!document.getElementById('challengeFilter') || document.getElementById('challengeFilter').value === 'all')) {
                        const challengeGroups = {};
                        
                        // Group by challengeId
                        snapshot.forEach(doc => {
                            const data = doc.data();
                            if (data.challengeId) {
                                if (!challengeGroups[data.challengeId]) {
                                    challengeGroups[data.challengeId] = [];
                                }
                                challengeGroups[data.challengeId].push({ id: doc.id, ...data });
                            }
                        });
                        
                        // Display grouped results
                        for (const challengeId in challengeGroups) {
                            const participants = challengeGroups[challengeId];
                            
                            // Get challenge details
                            try {
                                const challengeDoc = await window.firestore.getDoc(
                                    window.firestore.doc(window.db, 'challenges', challengeId)
                                );
                                
                                if (challengeDoc.exists()) {
                                    const challengeData = challengeDoc.data();
                                    
                                    // Add challenge header row
                                    const headerRow = tbody.insertRow();
                                    headerRow.style.background = 'var(--primary-color)';
                                    headerRow.style.color = 'white';
                                    headerRow.innerHTML = `
                                        <td colspan="7" style="padding: 0.75rem; font-weight: bold;">
                                            ØªØ­Ø¯ÙŠ ${getGameName(challengeData.game)} - ${getDifficultyName(challengeData.difficulty)} 
                                            (${new Date(challengeData.startDate).toLocaleDateString('en-US')} - ${new Date(challengeData.endDate).toLocaleDateString('en-US')})
                                        </td>
                                    `;
                                    
                                    // Sort participants by time
                                    participants.sort((a, b) => a.time - b.time);
                                    
                                    // Add participant rows
                                    let rank = 1;
                                    participants.forEach(data => {
                                        const dateStr = data.timestamp ? 
                                            new Date(data.timestamp.seconds * 1000).toLocaleDateString('en-US') : '-';
                                        const row = tbody.insertRow();
                                        
                                        if (rank === 1) {
                                            row.style.background = 'rgba(255,215,0,0.1)';
                                        }
                                        
                                        row.innerHTML = `
                                            <td>${rank === 1 ? 'ğŸ† ' : ''}${rank++}</td>
                                            <td>${data.employeeId}</td>
                                            <td>${data.employeeName || data.employeeId}</td>
                                            <td>${getGameName(data.game)}</td>
                                            <td>${formatTime(data.time)}</td>
                                            <td>${getResultText(data.result)}</td>
                                            <td>${dateStr}</td>
                                        `;
                                    });
                                    
                                    // Add spacing row
                                    const spacerRow = tbody.insertRow();
                                    spacerRow.innerHTML = '<td colspan="7" style="height: 10px; background: transparent;"></td>';
                                }
                            } catch (error) {
                                console.error('Error getting challenge details:', error);
                            }
                        }
                        
                        if (Object.keys(challengeGroups).length === 0) {
                            tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ ØªØ­Ø¯ÙŠØ§Øª</td></tr>';
                        }
                    } else {
                        // Normal display for non-challenge views
                        let rank = 1;
                        snapshot.forEach(doc => {
                            const data = doc.data();
                            const dateStr = data.timestamp ? 
                                new Date(data.timestamp.seconds * 1000).toLocaleDateString('en-US') : '-';
                            const row = tbody.insertRow();
                            row.innerHTML = `
                                <td>${rank++}</td>
                                <td>${data.employeeId}</td>
                                <td>${data.employeeName || data.employeeId}</td>
                                <td>${getGameName(data.game || 'ØªØ­Ø¯ÙŠ')}</td>
                                <td>${formatTime(data.time)}</td>
                                <td>${getResultText(data.result)}</td>
                                <td>${dateStr}</td>
                            `;
                        });
                    }
                }
            } catch (error) {
                console.error('Error loading leaderboard:', error);
            }
        }

        // Games statistics
        async function loadGamesStats() {
            try {
                const games = ['sudoku', 'tictactoe', 'hangman', 'crossword', 'wordsearch'];
                const counts = {};
                
                for (const game of games) {
                    const q = window.firestore.query(
                        window.firestore.collection(window.db, 'gameResults'),
                        window.firestore.where('game', '==', game)
                    );
                    const snapshot = await window.firestore.getDocs(q);
                    counts[game] = snapshot.size;
                    document.getElementById(`${game}Plays`).textContent = snapshot.size;
                }
                
                // Create chart
                const ctx = document.getElementById('gamesChart');
                if (ctx) {
                    if (gamesChart) gamesChart.destroy();
                    
                    gamesChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['Ø³ÙˆØ¯ÙˆÙƒÙˆ', 'Ø¥ÙƒØ³ Ø£Ùˆ', 'Ø§Ù„Ø±Ø¬Ù„ Ø§Ù„Ù…Ø´Ù†ÙˆÙ‚', 'Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø§Ø·Ø¹Ø©', 'Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙƒÙ„Ù…Ø§Øª'],
                            datasets: [{
                                label: 'Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨',
                                data: Object.values(counts),
                                backgroundColor: 'rgba(243, 111, 42, 0.6)',
                                borderColor: 'rgba(243, 111, 42, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                }
            } catch (error) {
                console.error('Error loading games stats:', error);
            }
        }

        // Game Words Management
        document.getElementById('addHangmanWordForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const wordAr = document.getElementById('hangmanWordAr').value;
            const wordEn = document.getElementById('hangmanWordEn').value.toUpperCase();
            const hintAr = document.getElementById('hangmanHintAr').value;
            const hintEn = document.getElementById('hangmanHintEn').value;
            
            showLoading(true);
            
            try {
                await window.firestore.addDoc(
                    window.firestore.collection(window.db, 'hangmanWords'),
                    {
                        wordAr: wordAr,
                        wordEn: wordEn,
                        hintAr: hintAr,
                        hintEn: hintEn,
                        createdAt: window.firestore.serverTimestamp()
                    }
                );
                
                showMessage('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙ„Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                document.getElementById('addHangmanWordForm').reset();
                loadGameWords();
            } catch (error) {
                console.error('Error adding hangman word:', error);
                showMessage('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙ„Ù…Ø©', 'error');
            }
            
            showLoading(false);
        });

        document.getElementById('addCrosswordPuzzleForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('crosswordName').value;
            const acrossAr = document.getElementById('crosswordAcrossAr').value.split('\n').filter(x => x);
            const acrossEn = document.getElementById('crosswordAcrossEn').value.split('\n').filter(x => x);
            const downAr = document.getElementById('crosswordDownAr').value.split('\n').filter(x => x);
            const downEn = document.getElementById('crosswordDownEn').value.split('\n').filter(x => x);
            const grid = document.getElementById('crosswordGrid').value;
            
            showLoading(true);
            
            try {
                await window.firestore.addDoc(
                    window.firestore.collection(window.db, 'crosswordPuzzles'),
                    {
                        name: name,
                        acrossCluesAr: acrossAr,
                        acrossCluesEn: acrossEn,
                        downCluesAr: downAr,
                        downCluesEn: downEn,
                        grid: grid,
                        createdAt: window.firestore.serverTimestamp()
                    }
                );
                
                showMessage('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù„ØºØ² Ø¨Ù†Ø¬Ø§Ø­', 'success');
                document.getElementById('addCrosswordPuzzleForm').reset();
                loadGameWords();
            } catch (error) {
                console.error('Error adding crossword puzzle:', error);
                showMessage('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù„ØºØ²', 'error');
            }
            
            showLoading(false);
        });

        // Add Word Search word form handler
        document.getElementById('addWordsearchWordForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const wordAr = document.getElementById('wordsearchWordAr').value.toUpperCase();
            const wordEn = document.getElementById('wordsearchWordEn').value.toUpperCase();
            
            showLoading(true);
            
            try {
                await window.firestore.addDoc(
                    window.firestore.collection(window.db, 'wordsearchWords'),
                    {
                        wordAr: wordAr,
                        wordEn: wordEn,
                        createdAt: window.firestore.serverTimestamp()
                    }
                );
                
                showMessage('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙ„Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                document.getElementById('addWordsearchWordForm').reset();
                loadGameWords();
            } catch (error) {
                console.error('Error adding word search word:', error);
                showMessage('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙ„Ù…Ø©', 'error');
            }
            
            showLoading(false);
        });

        async function loadGameWords() {
            try {
                // Load Hangman words
                const hangmanSnapshot = await window.firestore.getDocs(
                    window.firestore.collection(window.db, 'hangmanWords')
                );
                
                const hangmanList = document.getElementById('hangmanWordsList');
                hangmanList.innerHTML = '';
                
                if (hangmanSnapshot.empty) {
                    hangmanList.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ„Ù…Ø§Øª</p>';
                } else {
                    hangmanSnapshot.forEach(doc => {
                        const data = doc.data();
                        const item = document.createElement('div');
                        item.className = 'word-item';
                        item.innerHTML = `
                            <div class="word-item-header">
                                <strong>AR: ${data.wordAr} | EN: ${data.wordEn}</strong>
                                <button class="btn btn-danger btn-icon" onclick="deleteHangmanWord('${doc.id}')">Ø­Ø°Ù</button>
                            </div>
                            <p>ØªÙ„Ù…ÙŠØ­ Ø¹Ø±Ø¨ÙŠ: ${data.hintAr}</p>
                            <p>English Hint: ${data.hintEn}</p>
                        `;
                        hangmanList.appendChild(item);
                    });
                }
                
                // Load Crossword puzzles
                const crosswordSnapshot = await window.firestore.getDocs(
                    window.firestore.collection(window.db, 'crosswordPuzzles')
                );
                
                const crosswordList = document.getElementById('crosswordPuzzlesList');
                crosswordList.innerHTML = '';
                
                if (crosswordSnapshot.empty) {
                    crosswordList.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù„ØºØ§Ø²</p>';
                } else {
                    crosswordSnapshot.forEach(doc => {
                        const data = doc.data();
                        const item = document.createElement('div');
                        item.className = 'word-item';
                        item.innerHTML = `
                            <div class="word-item-header">
                                <strong>${data.name}</strong>
                                <button class="btn btn-danger btn-icon" onclick="deleteCrosswordPuzzle('${doc.id}')">Ø­Ø°Ù</button>
                            </div>
                            <p>Ø£Ø¯Ù„Ø© Ø£ÙÙ‚ÙŠØ©: ${data.acrossCluesAr ? data.acrossCluesAr.length : 0} Ø¹Ø±Ø¨ÙŠØŒ ${data.acrossCluesEn ? data.acrossCluesEn.length : 0} Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ</p>
                            <p>Ø£Ø¯Ù„Ø© Ø¹Ù…ÙˆØ¯ÙŠØ©: ${data.downCluesAr ? data.downCluesAr.length : 0} Ø¹Ø±Ø¨ÙŠØŒ ${data.downCluesEn ? data.downCluesEn.length : 0} Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ</p>
                        `;
                        crosswordList.appendChild(item);
                    });
                }
                
                // Load Word Search words
                const wordsearchSnapshot = await window.firestore.getDocs(
                    window.firestore.collection(window.db, 'wordsearchWords')
                );
                
                const wordsearchList = document.getElementById('wordsearchWordsList');
                wordsearchList.innerHTML = '';
                
                if (wordsearchSnapshot.empty) {
                    wordsearchList.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ„Ù…Ø§Øª</p>';
                } else {
                    wordsearchSnapshot.forEach(doc => {
                        const data = doc.data();
                        const item = document.createElement('div');
                        item.className = 'word-item';
                        item.innerHTML = `
                            <div class="word-item-header">
                                <strong>AR: ${data.wordAr} | EN: ${data.wordEn}</strong>
                                <button class="btn btn-danger btn-icon" onclick="deleteWordsearchWord('${doc.id}')">Ø­Ø°Ù</button>
                            </div>
                        `;
                        wordsearchList.appendChild(item);
                    });
                }
            } catch (error) {
                console.error('Error loading game words:', error);
            }
        }

        async function deleteHangmanWord(id) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ÙƒÙ„Ù…Ø©ØŸ')) return;
            
            try {
                await window.firestore.deleteDoc(
                    window.firestore.doc(window.db, 'hangmanWords', id)
                );
                showMessage('ØªÙ… Ø­Ø°Ù Ø§Ù„ÙƒÙ„Ù…Ø©', 'success');
                loadGameWords();
            } catch (error) {
                console.error('Error deleting hangman word:', error);
            }
        }

        async function deleteCrosswordPuzzle(id) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù„ØºØ²ØŸ')) return;
            
            try {
                await window.firestore.deleteDoc(
                    window.firestore.doc(window.db, 'crosswordPuzzles', id)
                );
                showMessage('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù„ØºØ²', 'success');
                loadGameWords();
            } catch (error) {
                console.error('Error deleting crossword puzzle:', error);
            }
        }

        async function deleteWordsearchWord(id) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ÙƒÙ„Ù…Ø©ØŸ')) return;
            
            try {
                await window.firestore.deleteDoc(
                    window.firestore.doc(window.db, 'wordsearchWords', id)
                );
                showMessage('ØªÙ… Ø­Ø°Ù Ø§Ù„ÙƒÙ„Ù…Ø©', 'success');
                loadGameWords();
            } catch (error) {
                console.error('Error deleting word search word:', error);
            }
        }

        // Logo handling
        document.getElementById('logoInput').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const base64 = e.target.result;
                document.getElementById('logoPreview').src = base64;
                document.getElementById('logoPreview').style.display = 'block';
            };
            reader.readAsDataURL(file);
        });

        async function saveLogo() {
            const logoPreview = document.getElementById('logoPreview');
            if (!logoPreview.src) {
                showMessage('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø´Ø¹Ø§Ø± Ø£ÙˆÙ„Ø§Ù‹', 'error');
                return;
            }
            
            showLoading(true);
            
            try {
                await window.firestore.setDoc(
                    window.firestore.doc(window.db, 'settings', 'company'),
                    {
                        logo: logoPreview.src,
                        updatedAt: window.firestore.serverTimestamp(),
                        updatedBy: currentAdmin.email
                    },
                    { merge: true }
                );
                
                showMessage('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø´Ø¹Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­', 'success');
                loadCompanyLogo();
            } catch (error) {
                console.error('Error saving logo:', error);
                showMessage('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø´Ø¹Ø§Ø±', 'error');
            }
            
            showLoading(false);
        }

        async function loadCompanyLogo() {
            try {
                const settingsDoc = await window.firestore.getDoc(
                    window.firestore.doc(window.db, 'settings', 'company')
                );
                if (settingsDoc.exists()) {
                    const data = settingsDoc.data();
                    if (data.logo) {
                        document.getElementById('headerLogo').src = data.logo;
                        document.getElementById('headerLogo').style.display = 'block';
                    }
                }
            } catch (error) {
                console.error('Error loading logo:', error);
            }
        }

        // Add admin
        document.getElementById('addAdminForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;
            
            if (password.length < 6) {
                showMessage('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');
                return;
            }
            
            showLoading(true);
            
            try {
                await window.authFunctions.createUserWithEmailAndPassword(
                    window.auth,
                    email,
                    password
                );
                
                showMessage('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¯ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­', 'success');
                document.getElementById('addAdminForm').reset();
            } catch (error) {
                console.error('Error adding admin:', error);
                showMessage('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¯ÙŠØ±: ' + getErrorMessage(error.code), 'error');
            }
            
            showLoading(false);
        });

        // Export functions
        async function exportEmployees() {
            showLoading(true);
            
            try {
                const employees = [];
                const employeesSnapshot = await window.firestore.getDocs(
                    window.firestore.collection(window.db, 'employees')
                );
                
                employeesSnapshot.forEach(doc => {
                    const data = doc.data();
                    employees.push({
                        'Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù': doc.id,
                        'Ø§Ù„Ø§Ø³Ù…': data.name,
                        'Ø§Ù„Ù‚Ø³Ù…': data.department || '',
                        'Ø­Ø§Ù„Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±': data.password ? 'ØªÙ… Ø§Ù„ØªØ¹ÙŠÙŠÙ†' : 'ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø±',
                        'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡': data.createdAt ? new Date(data.createdAt.seconds * 1000).toLocaleDateString('en-US') : '-'
                    });
                });
                
                const ws = XLSX.utils.json_to_sheet(employees);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†');
                XLSX.writeFile(wb, `DWE_Employees_${new Date().toISOString().split('T')[0]}.xlsx`);
                
                showMessage('ØªÙ… ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­', 'success');
            } catch (error) {
                console.error('Error exporting employees:', error);
                showMessage('Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†', 'error');
            }
            
            showLoading(false);
        }

        async function exportGameResults() {
            showLoading(true);
            
            try {
                const gameResults = [];
                const resultsSnapshot = await window.firestore.getDocs(
                    window.firestore.query(
                        window.firestore.collection(window.db, 'gameResults'),
                        window.firestore.orderBy('timestamp', 'desc')
                    )
                );
                
                resultsSnapshot.forEach(doc => {
                    const data = doc.data();
                    gameResults.push({
                        'Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù': data.employeeId,
                        'Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù': data.employeeName || data.employeeId,
                        'Ø§Ù„Ù„Ø¹Ø¨Ø©': getGameName(data.game),
                        'Ø§Ù„ÙˆÙ‚Øª (Ø«ÙˆØ§Ù†ÙŠ)': Math.floor(data.time / 1000),
                        'Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø³Ù‚': formatTime(data.time),
                        'Ø§Ù„Ù†ØªÙŠØ¬Ø©': getResultText(data.result),
                        'ØªØ­Ø¯ÙŠ': data.isChallenge ? 'Ù†Ø¹Ù…' : 'Ù„Ø§',
                        'Ø±Ù‚Ù… Ø§Ù„ØªØ­Ø¯ÙŠ': data.challengeId || '',
                        'Ø§Ù„ØªØ§Ø±ÙŠØ®': data.timestamp ? new Date(data.timestamp.seconds * 1000).toLocaleDateString('en-US') : '-',
                        'Ø§Ù„ÙˆÙ‚Øª': data.timestamp ? new Date(data.timestamp.seconds * 1000).toLocaleTimeString('en-US') : '-'
                    });
                });
                
                const ws = XLSX.utils.json_to_sheet(gameResults);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨');
                XLSX.writeFile(wb, `DWE_GameResults_${new Date().toISOString().split('T')[0]}.xlsx`);
                
                showMessage('ØªÙ… ØªØµØ¯ÙŠØ± Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            } catch (error) {
                console.error('Error exporting game results:', error);
                showMessage('Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨', 'error');
            }
            
            showLoading(false);
        }

        async function exportChallenges() {
            showLoading(true);
            
            try {
                const challenges = [];
                const challengesSnapshot = await window.firestore.getDocs(
                    window.firestore.query(
                        window.firestore.collection(window.db, 'challenges'),
                        window.firestore.orderBy('createdAt', 'desc')
                    )
                );
                
                for (const doc of challengesSnapshot.docs) {
                    const data = doc.data();
                    
                    // Get participant count
                    const participantsQuery = window.firestore.query(
                        window.firestore.collection(window.db, 'gameResults'),
                        window.firestore.where('challengeId', '==', doc.id)
                    );
                    const participantsSnapshot = await window.firestore.getDocs(participantsQuery);
                    
                    challenges.push({
                        'Ø±Ù‚Ù… Ø§Ù„ØªØ­Ø¯ÙŠ': doc.id,
                        'Ø§Ù„Ù„Ø¹Ø¨Ø©': getGameName(data.game),
                        'Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø©': getDifficultyName(data.difficulty),
                        'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©': new Date(data.startDate).toLocaleDateString('en-US'),
                        'ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©': new Date(data.endDate).toLocaleDateString('en-US'),
                        'Ø§Ù„ÙˆØµÙ': data.description || '',
                        'Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†': participantsSnapshot.size,
                        'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡': data.createdAt ? new Date(data.createdAt.seconds * 1000).toLocaleDateString('en-US') : '-',
                        'Ø£Ù†Ø´Ø¦ Ø¨ÙˆØ§Ø³Ø·Ø©': data.createdBy || ''
                    });
                }
                
                const ws = XLSX.utils.json_to_sheet(challenges);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª');
                XLSX.writeFile(wb, `DWE_Challenges_${new Date().toISOString().split('T')[0]}.xlsx`);
                
                showMessage('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
            } catch (error) {
                console.error('Error exporting challenges:', error);
                showMessage('Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª', 'error');
            }
            
            showLoading(false);
        }

        async function exportAllData() {
            showLoading(true);
            
            try {
                const wb = XLSX.utils.book_new();
                
                // Export Employees
                const employees = [];
                const employeesSnapshot = await window.firestore.getDocs(
                    window.firestore.collection(window.db, 'employees')
                );
                
                employeesSnapshot.forEach(doc => {
                    const data = doc.data();
                    employees.push({
                        'Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù': doc.id,
                        'Ø§Ù„Ø§Ø³Ù…': data.name,
                        'Ø§Ù„Ù‚Ø³Ù…': data.department || '',
                        'Ø­Ø§Ù„Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±': data.password ? 'ØªÙ… Ø§Ù„ØªØ¹ÙŠÙŠÙ†' : 'ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø±',
                        'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡': data.createdAt ? new Date(data.createdAt.seconds * 1000).toLocaleDateString('en-US') : '-'
                    });
                });
                
                const employeesWS = XLSX.utils.json_to_sheet(employees);
                XLSX.utils.book_append_sheet(wb, employeesWS, 'Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†');
                
                // Export Game Results
                const gameResults = [];
                const resultsSnapshot = await window.firestore.getDocs(
                    window.firestore.query(
                        window.firestore.collection(window.db, 'gameResults'),
                        window.firestore.orderBy('timestamp', 'desc')
                    )
                );
                
                resultsSnapshot.forEach(doc => {
                    const data = doc.data();
                    gameResults.push({
                        'Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù': data.employeeId,
                        'Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù': data.employeeName || data.employeeId,
                        'Ø§Ù„Ù„Ø¹Ø¨Ø©': getGameName(data.game),
                        'Ø§Ù„ÙˆÙ‚Øª (Ø«ÙˆØ§Ù†ÙŠ)': Math.floor(data.time / 1000),
                        'Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø³Ù‚': formatTime(data.time),
                        'Ø§Ù„Ù†ØªÙŠØ¬Ø©': getResultText(data.result),
                        'ØªØ­Ø¯ÙŠ': data.isChallenge ? 'Ù†Ø¹Ù…' : 'Ù„Ø§',
                        'Ø±Ù‚Ù… Ø§Ù„ØªØ­Ø¯ÙŠ': data.challengeId || '',
                        'Ø§Ù„ØªØ§Ø±ÙŠØ®': data.timestamp ? new Date(data.timestamp.seconds * 1000).toLocaleDateString('en-US') : '-'
                    });
                });
                
                const gameResultsWS = XLSX.utils.json_to_sheet(gameResults);
                XLSX.utils.book_append_sheet(wb, gameResultsWS, 'Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨');
                
                // Export Challenges
                const challenges = [];
                const challengesSnapshot = await window.firestore.getDocs(
                    window.firestore.collection(window.db, 'challenges')
                );
                
                for (const doc of challengesSnapshot.docs) {
                    const data = doc.data();
                    
                    // Get participant count
                    const participantsQuery = window.firestore.query(
                        window.firestore.collection(window.db, 'gameResults'),
                        window.firestore.where('challengeId', '==', doc.id)
                    );
                    const participantsSnapshot = await window.firestore.getDocs(participantsQuery);
                    
                    challenges.push({
                        'Ø±Ù‚Ù… Ø§Ù„ØªØ­Ø¯ÙŠ': doc.id,
                        'Ø§Ù„Ù„Ø¹Ø¨Ø©': getGameName(data.game),
                        'Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø©': getDifficultyName(data.difficulty),
                        'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©': new Date(data.startDate).toLocaleDateString('en-US'),
                        'ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©': new Date(data.endDate).toLocaleDateString('en-US'),
                        'Ø§Ù„ÙˆØµÙ': data.description || '',
                        'Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†': participantsSnapshot.size,
                        'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡': data.createdAt ? new Date(data.createdAt.seconds * 1000).toLocaleDateString('en-US') : '-'
                    });
                }
                
                const challengesWS = XLSX.utils.json_to_sheet(challenges);
                XLSX.utils.book_append_sheet(wb, challengesWS, 'Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª');
                
                // Export Game Words
                const hangmanWords = [];
                const hangmanSnapshot = await window.firestore.getDocs(
                    window.firestore.collection(window.db, 'hangmanWords')
                );
                
                hangmanSnapshot.forEach(doc => {
                    const data = doc.data();
                    hangmanWords.push({
                        'Ø§Ù„ÙƒÙ„Ù…Ø© Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©': data.wordAr,
                        'Ø§Ù„ÙƒÙ„Ù…Ø© Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©': data.wordEn,
                        'Ø§Ù„ØªÙ„Ù…ÙŠØ­ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©': data.hintAr,
                        'Ø§Ù„ØªÙ„Ù…ÙŠØ­ Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©': data.hintEn
                    });
                });
                
                if (hangmanWords.length > 0) {
                    const hangmanWS = XLSX.utils.json_to_sheet(hangmanWords);
                    XLSX.utils.book_append_sheet(wb, hangmanWS, 'ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø±Ø¬Ù„ Ø§Ù„Ù…Ø´Ù†ÙˆÙ‚');
                }
                
                // Export Word Search Words
                const wordsearchWords = [];
                const wordsearchSnapshot = await window.firestore.getDocs(
                    window.firestore.collection(window.db, 'wordsearchWords')
                );
                
                wordsearchSnapshot.forEach(doc => {
                    const data = doc.data();
                    wordsearchWords.push({
                        'Ø§Ù„ÙƒÙ„Ù…Ø© Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©': data.wordAr,
                        'Ø§Ù„ÙƒÙ„Ù…Ø© Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©': data.wordEn
                    });
                });
                
                if (wordsearchWords.length > 0) {
                    const wordsearchWS = XLSX.utils.json_to_sheet(wordsearchWords);
                    XLSX.utils.book_append_sheet(wb, wordsearchWS, 'ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¨Ø­Ø«');
                }
                
                XLSX.writeFile(wb, `DWE_CompleteExport_${new Date().toISOString().split('T')[0]}.xlsx`);
                
                showMessage('ØªÙ… ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
            } catch (error) {
                console.error('Error exporting all data:', error);
                showMessage('Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
            }
            
            showLoading(false);
        }

        // Legacy export function - keeping for compatibility
        async function exportData() {
            await exportAllData();
        }

        async function resetPasswords() {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±ØŸ')) return;
            
            showLoading(true);
            
            try {
                const batch = window.firestore.writeBatch(window.db);
                const snapshot = await window.firestore.getDocs(
                    window.firestore.collection(window.db, 'employees')
                );
                
                snapshot.forEach(doc => {
                    batch.update(doc.ref, { password: null });
                });
                
                await batch.commit();
                showMessage('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±', 'success');
                loadEmployees();
            } catch (error) {
                console.error('Error resetting passwords:', error);
                showMessage('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±', 'error');
            }
            
            showLoading(false);
        }

        // Helper functions
        function getGameName(gameId) {
            const games = {
                'sudoku': 'Ø³ÙˆØ¯ÙˆÙƒÙˆ',
                'tictactoe': 'Ø¥ÙƒØ³ Ø£Ùˆ',
                'hangman': 'Ø§Ù„Ø±Ø¬Ù„ Ø§Ù„Ù…Ø´Ù†ÙˆÙ‚',
                'crossword': 'Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø§Ø·Ø¹Ø©',
                'wordsearch': 'Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙƒÙ„Ù…Ø§Øª'
            };
            return games[gameId] || gameId;
        }

        function getDifficultyName(difficulty) {
            const difficulties = {
                'easy': 'Ø³Ù‡Ù„',
                'medium': 'Ù…ØªÙˆØ³Ø·',
                'hard': 'ØµØ¹Ø¨',
                'expert': 'Ø®Ø¨ÙŠØ±'
            };
            return difficulties[difficulty] || difficulty;
        }

        function getResultText(result) {
            const results = {
                'completed': 'Ù…ÙƒØªÙ…Ù„',
                'won': 'ÙÙˆØ²',
                'lost': 'Ø®Ø³Ø§Ø±Ø©',
                'winner_X': 'ÙØ§Ø² X',
                'winner_O': 'ÙØ§Ø² O',
                'draw': 'ØªØ¹Ø§Ø¯Ù„'
            };
            return results[result] || result;
        }

        function formatTime(milliseconds) {
            const totalSeconds = Math.floor(milliseconds / 1000);
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `${minutes}:${String(seconds).padStart(2, '0')}`;
        }

        function showMessage(message, type) {
            const messageBox = document.getElementById('messageBox');
            messageBox.className = `message ${type}`;
            messageBox.textContent = message;
            messageBox.style.display = 'block';
            setTimeout(() => {
                messageBox.style.display = 'none';
            }, 5000);
        }

        function showUploadMessage(message, type) {
            const messageBox = document.getElementById('uploadMessage');
            messageBox.className = `message ${type}`;
            messageBox.textContent = message;
            messageBox.style.display = 'block';
            setTimeout(() => {
                messageBox.style.display = 'none';
            }, 5000);
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'flex' : 'none';
        }

        function showModal(title, body) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalBody').innerHTML = body;
            document.getElementById('modal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('modal');
            if (event.target === modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>
